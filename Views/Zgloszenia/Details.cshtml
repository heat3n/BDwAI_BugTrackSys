@model BDwAI_BugTrackSys.Models.Zgloszenie

@{
    ViewData["Title"] = "Details";
}

<h1>Details</h1>

<div>
    <h4>Zgloszenie</h4>
    <hr />
    <dl class="row">
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Temat)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Temat)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Opis)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Opis)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.DataUtworzenia)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.DataUtworzenia)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Projekt)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Projekt.Nazwa)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Priorytet)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Priorytet.Nazwa)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Status)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Status.Nazwa)
        </dd>
        
        @if (User.IsInRole("Admin"))
        {
            <dt class="col-sm-2">Autor</dt>
            <dd class="col-sm-10">@(Model.Uzytkownik?.UserName ?? "Nieznany")</dd>
        }
    </dl>
</div>

<hr />

<h3>Komentarze</h3>

<div>
    @if (Model.Komentarze != null && Model.Komentarze.Any())
    {
        foreach (var kom in Model.Komentarze.OrderBy(k => k.DataDodania))
        {
            <div style="margin-bottom: 15px; border-bottom: 1px solid #ddd; padding-bottom: 5px;">
                <strong>@kom.Autor</strong> <span style="color: gray; font-size: 0.9em;">(@kom.DataDodania)</span>
                <br />
                @kom.Tresc
            </div>
        }
    }
    else
    {
        <p>Brak komentarzy.</p>
    }
</div>

@if (User.Identity.IsAuthenticated)
{
    <div style="margin-top: 20px;">
        <form asp-action="AddComment" method="post">
            <input type="hidden" name="zgloszenieId" value="@Model.Id" />
            
            <div class="form-group">
                <label>Dodaj komentarz:</label>
                <textarea name="tresc" class="form-control" rows="3"></textarea>
            </div>
            <br />
            <button type="submit" class="btn btn-primary">Wyślij</button>
        </form>
    </div>
}
<br />

<div>
    @if (User.IsInRole("Admin"))
    {
        <a asp-action="Edit" asp-route-id="@Model?.Id">Edit</a> <span>|</span>
    }
    <a asp-action="Index">Back to List</a>
</div>